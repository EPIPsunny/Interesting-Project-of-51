C51 COMPILER V9.01   MAIN                                                                  09/12/2021 19:17:22 PAGE 1   


C51 COMPILER V9.01, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN main.OBJ
COMPILER INVOKED BY: D:\51software\C51\BIN\C51.EXE main.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          
   2          //ºÚÏßÌù3ÀåÃ×¿í£¬·ñÔòÐ¡³µ°Ú¶¯ºÜÀ÷º¦       ÉÏ18  ×ó08 ÓÒ5A  ºó1C  ÒôÀÖ47  Ä£Ê½46
   3          #include <reg52.h>//51Í·ÎÄ¼þ
   4          #include <QX_A11.h>//QX_A11ÖÇÄÜÐ¡³µÅäÖÃÎÄ¼þ
   5          #include <intrins.h>
   6          typedef  int u16;         //¶ÔÊý¾ÝÀàÐÍ½øÐÐÉùÃ÷¶¨Òå
   7          typedef unsigned char u8;
   8          unsigned char   pwm_val_left,pwm_val_right;     //ÖÐ¼ä±äÁ¿£¬ÓÃ»§ÇëÎðÐÞ¸Ä¡£
   9          unsigned char   pwm_left,pwm_right;                     //¶¨ÒåPWMÊä³ö¸ßµçÆ½µÄÊ±¼äµÄ±äÁ¿¡£ÓÃ»§²Ù×÷PWMµÄ±äÁ¿¡£
  10          #define         PWM_DUTY                200                     //¶¨ÒåPWMµÄÖÜÆÚ£¬ÊýÖµÎª¶¨Ê±Æ÷0Òç³öÖÜÆÚ£¬¼ÙÈç¶¨Ê±Æ÷Òç³öÊ±¼äÎª100us£¬ÔòPWMÖÜÆÚÎª20m
             -s¡£
  11          #define         PWM_HIGH_MIN    70                      //ÏÞÖÆPWMÊä³öµÄ×îÐ¡Õ¼¿Õ±È¡£ÓÃ»§ÇëÎðÐÞ¸Ä¡£
  12          #define         PWM_HIGH_MAX    PWM_DUTY        //ÏÞÖÆPWMÊä³öµÄ×î´óÕ¼¿Õ±È¡£ÓÃ»§ÇëÎðÐÞ¸Ä¡£
  13          
  14          void Timer0_Init(void); //¶¨Ê±Æ÷0³õÊ¼»¯
  15          void LoadPWM(void);//×°ÈëPWMÊä³öÖµ 
  16          void forward(unsigned char LeftSpeed,unsigned char RightSpeed);//QX_A11ÖÇÄÜÐ¡³µÇ°½ø 
  17          void left_run(unsigned char LeftSpeed,unsigned char RightSpeed);//QX_A11ÖÇÄÜÐ¡³µ×ó×ª  
  18          void right_run(unsigned char LeftSpeed,unsigned char RightSpeed);//QX_A11ÖÇÄÜÐ¡³µÓÒ×ª
  19          void stop(void);//QX_A11ÖÇÄÜÐ¡³µÍ£³µ
  20          void back(unsigned char LeftSpeed,unsigned char RightSpeed);
  21          
  22          u8 IrValue[6];
  23          u8 Time;
  24          
  25          u8 DisplayData[8];
  26          
  27          
  28          void wait(u16 i)
  29          {
  30   1              while(i--);     
  31   1      }
  32          void delay(u16 i)
  33          {
  34   1              while(i--);     
  35   1      }
  36          
  37          void IrInit()    //ºìÍâÍ¨ÐÅÖÐ¶ÏÔÊÐí
  38          {
  39   1              IT0=1;//ÏÂ½µÑØ´¥·¢
  40   1              EX0=1;//´ò¿ªÖÐ¶Ï0ÔÊÐí
  41   1              EA=1;   //´ò¿ª×ÜÖÐ¶Ï
  42   1      
  43   1              IRIN=1;//³õÊ¼»¯¶Ë¿Ú
  44   1      }
  45          void Int1Init()    //ÒÔÍâ²¿ÖÐ¶Ï1ÎªÀý ,¼ì²âP3^2¿Ú
  46          {
  47   1        IT1=1;      //ÉèÖÃÍâ²¿ÖÐ¶Ï´¥·¢·½Ê½£ºÑ¡ÔñÏÂ½µÑØ´¥·¢£¬ÈôÎª0ÔòÎªµÍµçÆ½´¥·¢
  48   1        EX1=1;      //´ò¿ªÍâ²¿ÖÐ¶Ï1
  49   1        EA=1;           //´ò¿ªCPU×ÜÖÐ¶Ï
  50   1      
  51   1      }
  52          
  53          
  54          /*void Tracking()
C51 COMPILER V9.01   MAIN                                                                  09/12/2021 19:17:22 PAGE 2   

  55          {
  56                  //Îª0 Ã»ÓÐÊ¶±ðµ½ºÚÏß Îª1Ê¶±ðµ½ºÚÏß
  57                  char data1,data2 = left_led1,data3 = right_led1;
  58                  data1 = data2*10+data3;
  59                  if(data1 == 11)//ÔÚºÚÏßÉÏ£¬Ç°½ø
  60                  {
  61                          forward(120,120);//Ç°½ø
  62                  }
  63                  else
  64                  {
  65                          if(data1 == 10)//Ð¡·ùÆ«ÓÒ£¬×ó×ª
  66                          {
  67                                  left_run(80,160);//×ó×ª
  68                          }
  69                          if(data1 == 1)//Ð¡·ùÆ«×ó£¬ÓÒ×ª
  70                          {
  71                                  right_run(160,80);//ÓÒ×ª
  72                          }
  73                          if(data1 == 0)//´ó·ùÆ«×ó»òÆ«ÓÒ£¬ÒÑÍÑÀë¹ìµÀ
  74                          {
  75                                  stop(); 
  76                          }
  77                  }
  78          } */
  79          
  80          /*Ö÷º¯Êý*/     
  81          void main(void)
  82          {
  83   1          u16 m;
  84   1              u16 i;
  85   1              u8 rem;
  86   1              u8 symbol=0;
  87   1              u8 lowspeed=90;
  88   1              u8 highspeed=180;
  89   1              Timer0_Init();//¶¨Ê±0³õÊ¼»¯
  90   1              IrInit();
  91   1              Int1Init();
  92   1              IrValue[2]=0x00;
  93   1              
  94   1              while(1)
  95   1              {
  96   2                      
  97   2                       if(IrValue[2]==0x46)
  98   2                        {
  99   3                          symbol=!symbol;
 100   3                          rem=IrValue[2];
 101   3                          LED1=!LED1;
 102   3                              IrValue[2]=0x00;
 103   3                              delay(50000);
 104   3                        }
 105   2                      
 106   2                      if(IrValue[2]==0x18)
 107   2                      {
 108   3                         if(symbol==0)
 109   3                         {
 110   4                           forward(lowspeed,lowspeed);
 111   4                         }
 112   3                         if(symbol==1)
 113   3                         {
 114   4                           forward(highspeed,highspeed);
 115   4                         }
 116   3                         rem=IrValue[2];
C51 COMPILER V9.01   MAIN                                                                  09/12/2021 19:17:22 PAGE 3   

 117   3                         wait(5000);//Ç°½ø
 118   3                      }
 119   2                      else if(IrValue[2]==0x08)
 120   2                      {
 121   3                         if(symbol==0)
 122   3                         {
 123   4                           left_run(lowspeed,lowspeed);
 124   4                         }
 125   3                         if(symbol==1)
 126   3                         {
 127   4                           left_run(highspeed,highspeed);
 128   4                         }
 129   3                         rem=IrValue[2];
 130   3                      }
 131   2                      else if(IrValue[2]==0x5a)
 132   2                      {
 133   3                         if(symbol==0)
 134   3                         {
 135   4                           right_run(lowspeed,lowspeed);
 136   4                         }
 137   3                         if(symbol==1)
 138   3                         {
 139   4                           right_run(highspeed,highspeed);
 140   4                         }
 141   3                         rem=IrValue[2];
 142   3                         wait(5000);
 143   3                      }
 144   2                      else if(IrValue[2]==0x1c)
 145   2                      {
 146   3                         if(symbol==0)
 147   3                         {
 148   4                           back(lowspeed,lowspeed);
 149   4                         }
 150   3                         if(symbol==1)
 151   3                         {
 152   4                           back(highspeed,highspeed);
 153   4                         }
 154   3                         rem=IrValue[2];
 155   3                         wait(5000);
 156   3                      }
 157   2                      else if(IrValue[2]==0x45) 
 158   2                      {
 159   3                         stop();
 160   3                         wait(5000);
 161   3                         rem=IrValue[2];
 162   3                      }
 163   2      
 164   2                      else if(IrValue[2]==0x47) 
 165   2                      {
 166   3                         KEY=0;
 167   3                         
 168   3                         wait(5000);
 169   3                         KEY=1;
 170   3                         LED2=!LED2;
 171   3                         IrValue[2]=0x00;
 172   3                         
 173   3                      }
 174   2      
 175   2                      
 176   2              }       
 177   1      }
*** WARNING C280 IN LINE 83 OF MAIN.C: 'm': unreferenced local variable
C51 COMPILER V9.01   MAIN                                                                  09/12/2021 19:17:22 PAGE 4   

*** WARNING C280 IN LINE 84 OF MAIN.C: 'i': unreferenced local variable
 178          
 179          void Int1() interrupt 2         //µ±¼ì²âµ½P3^3¿ÚÏÂ½µÑØ´¥·¢
 180          {
 181   1        u16 num=300,i;
 182   1        delay(1000);                     //Ïû¶¶
 183   1        if(KEY==0)
 184   1        {
 185   2      
 186   2          for(i=0;i<num;i++)
 187   2              {
 188   3                beep=!beep;
 189   3                delay(50);
 190   3                beep=!beep;
 191   3                delay(50);
 192   3              }
 193   2            
 194   2        }
 195   1      
 196   1      }
 197          
 198          
 199          /*********************************************
 200          QX_A11ÖÇÄÜÐ¡³µÇ°½ø
 201          Èë¿Ú²ÎÊý£ºLeftSpeed£¬RightSpeed
 202          ³ö¿Ú²ÎÊý: ÎÞ
 203          ËµÃ÷£ºLeftSpeed£¬RightSpeed·Ö±ðÉèÖÃ×óÓÒ³µÂÖ×ªËÙ
 204          **********************************************/
 205          void forward(unsigned char LeftSpeed,unsigned char RightSpeed)
 206          {
 207   1              pwm_left = LeftSpeed,pwm_right =  RightSpeed;//ÉèÖÃËÙ¶È
 208   1              left_motor_go; //×óµç»úÇ°½ø
 209   1              right_motor_go; //ÓÒµç»úÇ°½ø
 210   1      }
 211          /*Ð¡³µ×ó×ª*/
 212          /*********************************************
 213          QX_A11ÖÇÄÜÐ¡³µ×ó×ª
 214          Èë¿Ú²ÎÊý£ºLeftSpeed£¬RightSpeed
 215          ³ö¿Ú²ÎÊý: ÎÞ
 216          ËµÃ÷£ºLeftSpeed£¬RightSpeed·Ö±ðÉèÖÃ×óÓÒ³µÂÖ×ªËÙ
 217          **********************************************/
 218          void left_run(unsigned char LeftSpeed,unsigned char RightSpeed)
 219          {
 220   1              pwm_left = LeftSpeed,pwm_right =  RightSpeed;//ÉèÖÃËÙ¶È
 221   1              left_motor_back; //×óµç»úºóÍË
 222   1              right_motor_go; //ÓÒµç»úÇ°½ø    
 223   1      }
 224          
 225          /*********************************************
 226          QX_A11ÖÇÄÜÐ¡³µÓÒ×ª
 227          Èë¿Ú²ÎÊý£ºLeftSpeed£¬RightSpeed
 228          ³ö¿Ú²ÎÊý: ÎÞ
 229          ËµÃ÷£ºLeftSpeed£¬RightSpeed·Ö±ðÉèÖÃ×óÓÒ³µÂÖ×ªËÙ
 230          **********************************************/
 231          void right_run(unsigned char LeftSpeed,unsigned char RightSpeed)
 232          {
 233   1              pwm_left = LeftSpeed,pwm_right =  RightSpeed;//ÉèÖÃËÙ¶È
 234   1              right_motor_back;//ÓÒµç»úºóÍË
 235   1              left_motor_go;    //×óµç»úÇ°½ø
 236   1      }
 237          /*********************************************
 238          QX_A11ÖÇÄÜÐ¡³µÍ£³µ
C51 COMPILER V9.01   MAIN                                                                  09/12/2021 19:17:22 PAGE 5   

 239          Èë¿Ú²ÎÊý£ºÎÞ
 240          ³ö¿Ú²ÎÊý: ÎÞ
 241          ËµÃ÷£ºQX_A11ÖÇÄÜÐ¡³µÍ£³µ
 242          **********************************************/
 243          void stop(void)
 244          {
 245   1              left_motor_stops;
 246   1              right_motor_stops;
 247   1      }
 248          void back(unsigned char LeftSpeed,unsigned char RightSpeed)
 249          {
 250   1              pwm_left = LeftSpeed,pwm_right =  RightSpeed;//ÉèÖÃËÙ¶È
 251   1              right_motor_back;//ÓÒµç»úºóÍË
 252   1              left_motor_back;    //×óµç»úÇ°½ø
 253   1      }
 254          /*********************************************
 255          QX_A11ÖÇÄÜÐ¡³µPWMÊä³ö
 256          Èë¿Ú²ÎÊý£ºÎÞ
 257          ³ö¿Ú²ÎÊý: ÎÞ
 258          ËµÃ÷£º×°ÔØPWMÊä³ö,Èç¹ûÉèÖÃÈ«¾Ö±äÁ¿pwm_left,pwm_right·Ö±ðÅäÖÃ×óÓÒÊä³ö¸ßµçÆ½Ê±¼ä
 259          **********************************************/
 260          void LoadPWM(void)
 261          {
 262   1              if(pwm_left > PWM_HIGH_MAX)             pwm_left = PWM_HIGH_MAX;        //Èç¹û×óÊä³öÐ´Èë´óÓÚ×î´óÕ¼¿Õ±ÈÊý¾Ý£¬ÔòÇ¿ÖÆÎª×î´óÕ¼¿
             -Õ±È¡£
 263   1              if(pwm_left < PWM_HIGH_MIN)             pwm_left = PWM_HIGH_MIN;        //Èç¹û×óÊä³öÐ´ÈëÐ¡ÓÚ×îÐ¡Õ¼¿Õ±ÈÊý¾Ý£¬ÔòÇ¿ÖÆÎª×îÐ¡Õ¼¿
             -Õ±È¡£
 264   1              if(pwm_right > PWM_HIGH_MAX)    pwm_right = PWM_HIGH_MAX;       //Èç¹ûÓÒÊä³öÐ´Èë´óÓÚ×î´óÕ¼¿Õ±ÈÊý¾Ý£¬ÔòÇ¿ÖÆÎª×î´óÕ¼
             -¿Õ±È¡£
 265   1              if(pwm_right < PWM_HIGH_MIN)    pwm_right = PWM_HIGH_MIN;       //Èç¹ûÓÒÊä³öÐ´ÈëÐ¡ÓÚ×îÐ¡Õ¼¿Õ±ÈÊý¾Ý£¬ÔòÇ¿ÖÆÎª×îÐ¡Õ¼
             -¿Õ±È¡£
 266   1              if(pwm_val_left<=pwm_left)              Left_moto_pwm = 1;  //×°ÔØ×óPWMÊä³ö¸ßµçÆ½Ê±¼ä
 267   1              else Left_moto_pwm = 0;                                                     //×°ÔØ×óPWMÊä³öµÍµçÆ½Ê±¼ä
 268   1              if(pwm_val_left>=PWM_DUTY)              pwm_val_left = 0;       //Èç¹û×ó¶Ô±ÈÖµ´óÓÚµÈÓÚ×î´óÕ¼¿Õ±ÈÊý¾Ý£¬ÔòÎªÁã
 269   1      
 270   1              if(pwm_val_right<=pwm_right)    Right_moto_pwm = 1; //×°ÔØÓÒPWMÊä³ö¸ßµçÆ½Ê±¼ä
 271   1              else Right_moto_pwm = 0;                                                        //×°ÔØÓÒPWMÊä³öµÍµçÆ½Ê±¼ä
 272   1              if(pwm_val_right>=PWM_DUTY)             pwm_val_right = 0;      //Èç¹ûÓÒ¶Ô±ÈÖµ´óÓÚµÈÓÚ×î´óÕ¼¿Õ±ÈÊý¾Ý£¬ÔòÎªÁã
 273   1      }
 274          /********************* Timer0³õÊ¼»¯************************/
 275          void Timer0_Init(void)
 276          {
 277   1              TMOD |= 0x02;//¶¨Ê±Æ÷0£¬8Î»×Ô¶¯ÖØ×°Ä£¿é
 278   1              TH0 = 164;
 279   1              TL0 = 164;//11.0592M¾§Õñ£¬12TÒç³öÊ±¼äÔ¼µÈÓÚ100Î¢Ãë
 280   1              TR0 = 1;//Æô¶¯¶¨Ê±Æ÷0
 281   1              ET0 = 1;//ÔÊÐí¶¨Ê±Æ÷0ÖÐ¶Ï
 282   1              EA      = 1;//×ÜÖÐ¶ÏÔÊÐí        
 283   1      }
 284           
 285          /********************* Timer0ÖÐ¶Ïº¯Êý************************/
 286          void timer0_int (void) interrupt 1
 287          {
 288   1               pwm_val_left++;
 289   1               pwm_val_right++;
 290   1               LoadPWM();//×°ÔØPWMÊä³ö
 291   1      }
 292          
 293            
 294          
 295          
 296          void ReadIr() interrupt 0       //ºìÍâÖÐ¶Ï³ÌÐò
C51 COMPILER V9.01   MAIN                                                                  09/12/2021 19:17:22 PAGE 6   

 297          {
 298   1              u8 j,k;
 299   1              u16 err;
 300   1              Time=0;                                  
 301   1              wait(700);      //7ms
 302   1              if(IRIN==0)             //È·ÈÏÊÇ·ñÕæµÄ½ÓÊÕµ½ÕýÈ·µÄÐÅºÅ
 303   1              {        
 304   2                      
 305   2                      err=1000;                               //1000*10us=10ms,³¬¹ýËµÃ÷½ÓÊÕµ½´íÎóµÄÐÅºÅ
 306   2                      /*µ±Á½¸öÌõ¼þ¶¼ÎªÕæÊÇÑ­»·£¬Èç¹ûÓÐÒ»¸öÌõ¼þÎª¼ÙµÄÊ±ºòÌø³öÑ­»·£¬ÃâµÃ³ÌÐò³ö´íµÄÊ±
 307   2                      ºî£¬³ÌÐòËÀÔÚÕâÀï*/      
 308   2                      while((IRIN==0)&&(err>0))       //µÈ´ýÇ°Ãæ9msµÄµÍµçÆ½¹ýÈ¥               
 309   2                      {                       
 310   3                              wait(1);
 311   3                              err--;
 312   3                      } 
 313   2                      if(IRIN==1)                     //Èç¹ûÕýÈ·µÈµ½9msµÍµçÆ½
 314   2                      {
 315   3                              err=500;
 316   3                              while((IRIN==1)&&(err>0))                //µÈ´ý4.5msµÄÆðÊ¼¸ßµçÆ½¹ýÈ¥
 317   3                              {
 318   4                                      wait(1);
 319   4                                      err--;
 320   4                              }
 321   3                              for(k=0;k<4;k++)                //¹²ÓÐ4×éÊý¾Ý
 322   3                              {                               
 323   4                                      for(j=0;j<8;j++)        //½ÓÊÕÒ»×éÊý¾Ý
 324   4                                      {
 325   5      
 326   5                                              err=60;         
 327   5                                              while((IRIN==0)&&(err>0))//µÈ´ýÐÅºÅÇ°ÃæµÄ560usµÍµçÆ½¹ýÈ¥
 328   5                                              {
 329   6                                                      wait(1);
 330   6                                                      err--;
 331   6                                              }
 332   5                                              err=500;
 333   5                                              while((IRIN==1)&&(err>0))        //¼ÆËã¸ßµçÆ½µÄÊ±¼ä³¤¶È¡£
 334   5                                              {
 335   6                                                      wait(10);        //0.1ms
 336   6                                                      Time++;
 337   6                                                      err--;
 338   6                                                      if(Time>30)
 339   6                                                      {
 340   7                                                              return;
 341   7                                                      }
 342   6                                              }
 343   5                                              IrValue[k]>>=1;  //k±íÊ¾µÚ¼¸×éÊý¾Ý
 344   5                                              if(Time>=8)                     //Èç¹û¸ßµçÆ½³öÏÖ´óÓÚ565us£¬ÄÇÃ´ÊÇ1
 345   5                                              {
 346   6                                                      IrValue[k]|=0x80;
 347   6                                              }
 348   5                                              Time=0;         //ÓÃÍêÊ±¼äÒªÖØÐÂ¸³Öµ                                                    
 349   5                                      }
 350   4                              }
 351   3                      }
 352   2                      if(IrValue[2]!=~IrValue[3])
 353   2                      {
 354   3                              return;
 355   3                      }
 356   2              }                       
 357   1      }       

C51 COMPILER V9.01   MAIN                                                                  09/12/2021 19:17:22 PAGE 7   


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    786    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     19       9
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  2 WARNING(S),  0 ERROR(S)
